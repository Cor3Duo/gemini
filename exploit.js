/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
*/
import { GoogleGenAI } from '@google/genai';

const ai = new GoogleGenAI({ apiKey: process.env.API_KEY });

const ws = new WebSocket('ws://localhost:9090');

ws.onopen = () => {
  console.log('connected');
};

ws.onmessage = async (message) => {
  const data = JSON.parse(message.data);

  const response = await ai.models.generateContent(data);

  const res: any = {
    text: response.text
  }

  if (response.functionCalls && response.functionCalls.length) {
    res.functionCalls = response.functionCalls;
  }

  console.log(response);

  ws.send(JSON.stringify(res));
}